[TOC]

# 三.绑定与验证

## 一.绑定

**绑定参数**（通常指的是从HTTP请求中提取数据并映射到应用程序的某个数据结构，如**结构体**、**类**等）允许开发人员轻松地从**客户端**请求中提取必要的信息，以便在**服务器端**进行处理。

### 1.ShouldBindJSON

```go
package main

import "github.com/gin-gonic/gin"

type UserInfo struct {
	Name string `json:"name"`
	Age  int    `json:"age"`
	Sex  string `json:"sex"`
}
func main(){
    router := gin.Default()
    router.POST("/", func(c *gin.Context) {
		var userInfo UserInfo
		err := c.ShouldBindJSON(&userInfo)
		if err != nil {
			c.JSON(200, gin.H{"data": "err"})
			return
		}
        c.JSON(200, gin.H{"data":"OK"})
	})
    _ = router.Run(":8080")
}
```

通过```ShouldBindJSON```函数，将**客户端**传入的```JSON```数据以```UserInfo```的形式提取信息

```go
//输入json形式的原始数据
{
    "name":"Outer",
    "age":18,
    "sex":"male"
}
//返回值
{
    "data":"OK"
}
```

### 2.ShouldBindQuery

```go
type UserInfo struct {
	Name string `form:"name"`
	Age  int    `form:"age"`
	Sex  string `form:"sex"`
}//需要在定义结构体时加入form的tag

router.POST("/query", func(c *gin.Context) {
		var userinfo UserInfo
		err := c.ShouldBindQuery(&userinfo)
		if err != nil {
			c.JSON(200, gin.H{"data": "err"})
			return
		}
		c.JSON(200, userinfo)
	})
```

通过```ShouldBindQuery```函数，将**客户端**传入的**动态参数**信息以```UserInfo```的形式提取信息

```go
//输入localhost:8080/query?name=Outer&age=18&sex=male
//返回值为：
{
    "name": "Outer",
    "age": 18,
    "sex": "male"
}
```

### 3.ShouldBindUri

```go
type UserInfo struct {
	Name string `uri:"name"`
	Age  int    `uri:"age"`
	Sex  string `uri:"sex"`
}//需要在定义结构体时加入uri的tag

router.POST("/uri/:name/:age/:sex", func(c *gin.Context) {
		var userinfo UserInfo
		err := c.ShouldBindUri(&userinfo)
		if err != nil {
			c.JSON(200, gin.H{"data": "err"})
			return
		}
		c.JSON(200, userinfo)
	})
```

通过```ShouldBindUri```函数，将**客户端**传入的**```Uri```**信息以```UserInfo```的形式提取信息

```go
//输入localhost:8080/uri/Outer/18/male
//返回值为：
{
    "name": "Outer",
    "age": 18,
    "sex": "male"
}
```

### 4.ShouldBind

```go
type UserInfo struct {
	Name string `form:"name"`
	Age  int    `form:"age"`
	Sex  string `form:"sex"`
}//需要在定义结构体时加入form的tag

router.POST("/form", func(c *gin.Context) {
		var userinfo UserInfo
		err := c.ShouldBind(&userinfo)
		if err != nil {
			c.JSON(200, gin.H{"data": "err"})
			return
		}
		c.JSON(200, userinfo)
	})
```

可以通过```ShouldBind```方法实现对```form-data```和```x-www-form-urlencoded```的绑定操作

此处需注意```ShouldBind```方法的源码：

```go
//ShouldBind将传入的数据进行类型的判断
func (c *Context) ShouldBind(obj any) error {
	b := binding.Default(c.Request.Method, c.ContentType())
	return c.ShouldBindWith(obj, b)
}
//binding.Default的内容：
func Default(method, contentType string) Binding {
	if method == http.MethodGet {
		return Form
	}

	switch contentType {
	case MIMEJSON:
		return JSON
	case MIMEXML, MIMEXML2:
		return XML
	case MIMEPROTOBUF:
		return ProtoBuf
	case MIMEMSGPACK, MIMEMSGPACK2:
		return MsgPack
	case MIMEYAML, MIMEYAML2:
		return YAML
	case MIMETOML:
		return TOML
	case MIMEMultipartPOSTForm:
		return FormMultipart
	default: // case MIMEPOSTForm:
		return Form
	}
}
//以form类型作为Default的返回值
```

